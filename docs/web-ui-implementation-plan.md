# Web-UI 待实现模块规划

> 创建时间: 2026-02-18
> 状态: 规划中

---

## 一、因子研究模块 (5个页面)

### 1.1 IC分析 `/research/ic`

**后端支持**: `ginkgo.research.ic_analysis.ICAnalyzer`

**功能设计**:
- **输入配置**
  - 因子数据源（文件上传CSV/数据库查询）
  - 收益周期选择（1d, 5d, 10d, 20d）
  - 计算方法（Pearson/Spearman）
- **结果展示**
  - 统计指标表格：IC均值、标准差、ICIR、t统计量、p值、正向比例、样本数
  - IC时间序列折线图
  - 各周期IC对比柱状图
- **交互**
  - 开始分析按钮
  - 导出结果

---

### 1.2 因子分层 `/research/layering`

**后端支持**: `ginkgo.research.layering`

**功能设计**:
- **输入配置**
  - 因子选择
  - 分层数量（5层/10层）
  - 收益周期
- **结果展示**
  - 各层收益统计表（平均收益、累积收益、夏普比率）
  - 多头/空头组合收益对比
  - 分层收益柱状图
  - 累积收益曲线（按层）

---

### 1.3 因子正交化 `/research/orthogonal`

**后端支持**: `ginkgo.research.orthogonalization`

**功能设计**:
- **输入配置**
  - 多因子选择（至少2个）
  - 正交化方法（施密特正交化/残差正交化）
- **结果展示**
  - 正交化前后因子相关性矩阵
  - 正交化后因子值预览
  - 方差膨胀因子（VIF）变化

---

### 1.4 因子比较 `/research/comparison`

**后端支持**: `ginkgo.research.factor_comparison`

**功能设计**:
- **输入配置**
  - 多因子选择（2-5个）
  - 时间范围
- **结果展示**
  - IC对比表（均值、ICIR、t值）
  - 因子相关性矩阵
  - IC时间序列对比图
  - 综合评分排名

---

### 1.5 因子衰减 `/research/decay`

**后端支持**: `ginkgo.research.decay_analysis`

**功能设计**:
- **输入配置**
  - 因子选择
  - 最大衰减周期（1-60天）
- **结果展示**
  - IC衰减曲线图
  - 半衰期计算结果
  - 衰减统计表

---

## 二、参数优化模块 (3个页面)

### 2.1 网格搜索 `/optimization/grid`

**功能设计**:
- **输入配置**
  - 策略选择
  - 参数范围定义（参数名、最小值、最大值、步长）
  - 回测配置（时间范围、初始资金）
- **执行状态**
  - 进度条
  - 已完成/总数
  - 预计剩余时间
- **结果展示**
  - 参数组合收益排名表
  - 热力图（二维参数）
  - 最优参数推荐

---

### 2.2 遗传算法 `/optimization/genetic`

**功能设计**:
- **输入配置**
  - 策略选择
  - 参数范围定义
  - 遗传算法配置（种群大小、迭代次数、变异率）
- **执行状态**
  - 当前进化代数
  - 最优适应度变化曲线
  - 种群多样性指标
- **结果展示**
  - 最优参数组合
  - 适应度进化曲线
  - 参数分布直方图

---

### 2.3 贝叶斯优化 `/optimization/bayesian`

**功能设计**:
- **输入配置**
  - 策略选择
  - 参数范围定义
  - 贝叶斯配置（初始点数、迭代次数、采集函数）
- **执行状态**
  - 当前进度
  - 探索vs利用状态
- **结果展示**
  - 最优参数
  - 后验分布图
  - 收敛曲线

---

## 三、组件管理模块（代码编辑器）

**数据模型**: `MFile`
- `type`: FILE_TYPES 枚举 (STRATEGY/RISKMANAGER/SIZER/SELECTOR/ANALYZER/HANDLER/ENGINE)
- `name`: 文件名
- `data`: 文件内容 (Python代码)

**FILE_TYPES 枚举值**:
- STRATEGY (6) - 策略代码
- RISKMANAGER (3) - 风控代码
- SIZER (5) - 仓位管理代码
- SELECTOR (4) - 选股器代码
- ANALYZER (1) - 分析器代码
- HANDLER (8) - 事件处理器
- ENGINE (7) - 引擎代码

### 3.1 策略组件 `/components/strategies`

**功能设计**:
- **文件列表** (type=STRATEGY)
  - 文件名、更新时间、大小
  - 搜索、新建、删除
- **代码编辑器**
  - Monaco Editor 集成
  - Python语法高亮
  - 代码自动补全（可选）
- **操作**
  - 保存文件
  - 运行测试（可选）
  - 查看使用该策略的组合

---

### 3.2 风控组件 `/components/risks`

**功能设计**:
- **文件列表** (type=RISKMANAGER)
  - 与策略组件相同布局
- **代码编辑器**
  - 同上

---

### 3.3 仓位组件 `/components/sizers`

**功能设计**:
- **文件列表** (type=SIZER)
  - 与策略组件相同布局
- **代码编辑器**
  - 同上

---

### 3.4 选股器组件 `/components/selectors`

**功能设计**:
- **文件列表** (type=SELECTOR)
  - 与策略组件相同布局
- **代码编辑器**
  - 同上

---

### 3.5 分析器组件 `/components/analyzers`

**功能设计**:
- **文件列表** (type=ANALYZER)
  - 与策略组件相同布局
- **代码编辑器**
  - 同上

---

### 3.6 事件处理器 `/components/handlers`

**功能设计**:
- **文件列表** (type=HANDLER)
  - 与策略组件相同布局
- **代码编辑器**
  - 同上

---

**建议**: 所有页面共用同一个代码编辑器组件，仅type参数不同

## 四、系统管理模块 (3个页面)

### 4.1 系统状态 `/system/status`

**功能设计**:
- **系统概览**
  - 服务运行状态
  - 数据库连接状态（ClickHouse/MySQL/Redis/MongoDB）
  - 版本信息
- **组件状态**
  - 各组件运行状态
  - Kafka连接状态
- **Worker管理**（整合）
  - Worker列表：ID、状态、当前任务、运行时长
  - 操作：启动/停止Worker（如支持）
  - 任务队列状态
- **资源监控**（需实时刷新）
  - CPU/内存使用率
  - 磁盘空间
  - **注意**: 后端接口可能不完整，需确认
- **最近日志**
  - TODO: 未来接入分布式日志系统
  - 当前版本暂不实现

---

### ~~4.2 Worker管理 `/system/workers`~~

**已合并到系统状态页面，删除此路由**

---

### 4.3 告警中心 `/system/alerts`

**状态**: 搁置，暂不实现

---

---

## 五、其他待实现页面

### 5.1 数据同步 `/data/sync`

**后端机制**:
- 通过 Kafka 发送 `ControlCommandDTO` 到 `ginkgo.data.commands` 主题
- `DataWorker` 消费命令并执行数据更新

**命令类型 (ControlCommandDTO.Commands)**:
| 命令 | 说明 | 参数 |
|------|------|------|
| BAR_SNAPSHOT | K线数据同步 | code, full, force |
| TICK | Tick数据同步 | code, full, overwrite |
| STOCKINFO | 股票信息同步 | 无参数 |
| ADJUSTFACTOR | 复权因子同步 | code |
| UPDATE_SELECTOR | 更新选股器 | - |
| UPDATE_DATA | 更新数据 | - |

**功能设计**:
- **发送同步命令**
  - 命令类型选择
  - 股票代码输入（单个/批量）
  - 参数配置（full/overwrite等）
- **命令状态**
  - 已发送命令列表
  - Kafka投递确认
- **注意**: 实际同步进度由DataWorker处理，页面只负责发送命令

---

### 5.2 走步验证 `/stage2/walkforward`

**后端支持**: `ginkgo.validation.walk_forward.WalkForwardValidator`

**功能设计**:
- **配置**
  - 策略/组合选择
  - 时间范围（start_date, end_date）
  - 折数 (n_folds)
  - 训练期比例 (train_ratio)
  - 窗口类型：滚动/扩展 (expanding)
- **执行**
  - 调用后端验证接口
  - 进度显示（当前折/总折数）
- **结果展示**
  - 各折训练/测试收益对比表
  - 退化程度 (degradation) - 评估过拟合
  - 样本外收益曲线
  - 稳定性指标

---

### 5.3 蒙特卡洛模拟 `/stage2/montecarlo`

**后端支持**: `ginkgo.validation.monte_carlo.MonteCarloSimulator`

**核心功能**: 基于历史收益分布进行随机模拟，评估风险

**功能设计**:
- **输入配置**
  - 数据源：选择历史回测结果 或 手动输入收益参数
  - 模拟次数 (n_simulations): 默认 10000
  - 置信水平 (confidence_level): 默认 95%
  - 时间范围 (time_horizon): 天数
- **结果展示**
  - 收益分布直方图
  - VaR (Value at Risk): 在置信水平下的最大损失
  - CVaR (Conditional VaR): 超过VaR时的平均损失
  - 分位数统计（5%、25%、50%、75%、95%）
  - 模拟路径图（可选）

**通俗解释**:
蒙特卡洛模拟 = 用历史数据"预测"未来可能的收益分布
- VaR 95% = 有95%的概率损失不会超过这个值
- CVaR = 如果发生极端情况（那5%），平均会损失多少

---

### 5.4 敏感性分析 `/stage2/sensitivity`

**后端支持**: `ginkgo.validation.sensitivity.SensitivityAnalyzer`

**核心功能**: 分析参数变化对策略表现的影响

**功能设计**:
- **输入配置**
  - 策略/组合选择
  - 参数名 (param_name)
  - 基准值 (base_value)
  - 测试值列表 (test_values)
- **结果展示**
  - 参数值 vs 收益曲线图
  - 敏感性分数（越高越敏感）
  - 弹性系数
  - 最优参数值
  - 各值详细指标表

**通俗解释**:
敏感性分析 = 测试参数变化对收益的影响程度
- 高敏感性 = 参数稍微变化，收益大幅波动（需要谨慎选择）
- 低敏感性 = 参数变化对收益影响小（策略更稳健）

---

### 5.5 回测对比 `/stage1/backtest/compare`

**数据来源**: 回测结果中的 Analyzer 数据

**功能设计**:
- **选择对比**
  - 多选回测任务（2-5个）
  - 显示哪些analyzer可对比
- **BASIC_ANALYZERS 对比**
  - NetValue: 净值曲线对比图
  - MaxDrawdown: 最大回撤对比
  - SharpeRatio: 夏普比率
  - AnnualizedReturn: 年化收益
  - WinRate: 胜率
  - Profit: 盈亏
  - Volatility: 波动率
  - SignalCount: 信号数量
- **自定义 Analyzer 对比**
  - 如果多个回测配置了相同的 analyzer，显示对比
- **对比展示**
  - 净值曲线叠加图
  - 指标对比表格
  - 雷达图（多维度对比）

---

### 5.6 实盘订单 `/stage4/live/orders` & 模拟订单 `/stage3/paper/orders`

**后端数据**: `MOrder` (MySQL存储)

**字段说明**:
| 字段 | 说明 |
|------|------|
| portfolio_id | 关联组合 |
| code | 股票代码 |
| direction | 买卖方向 |
| order_type | 订单类型（限价/市价） |
| status | 订单状态 |
| volume | 委托数量 |
| limit_price | 限价 |
| transaction_price | 成交价 |
| transaction_volume | 成交数量 |
| fee | 手续费 |
| timestamp | 订单时间 |

**功能设计**:
- **订单列表**
  - 表格展示订单记录
  - 筛选：状态、代码、时间范围
  - 排序：按时间倒序
- **刷新方式**
  - 手动刷新按钮（当前实现）
  - TODO: 后续通过 WebSocket 推送刷新通知
- **区分实盘/模拟**
  - 通过 portfolio_id 的 mode 字段区分

---

### 5.7 实盘持仓 `/stage4/live/positions`

**后端数据**: Position相关模型（需确认）

**功能设计**:
- **持仓列表**
  - 代码、名称、数量、成本、现价、盈亏、盈亏比例
  - 手动刷新（后续WebSocket推送）
- **汇总**
  - 总资产、总盈亏、持仓分布

---

## 六、需要完善的页面

### 6.1 概览 `/dashboard`

**需要完善**:
- 对接后端API获取真实数据
- 实现最近活动列表
- 考虑添加收益曲线图

---

## 实现优先级建议

**P1 - 高优先级**（核心功能）:
1. 组件管理（6个）- 代码编辑器，策略开发基础
2. 实盘/模拟订单和持仓 - 交易监控

**P2 - 中优先级**（策略验证）:
1. 系统状态（含Worker管理）
2. 回测对比
3. 走步验证
4. 数据同步
5. Dashboard完善

**P3 - 低优先级**（高级研究）:
1. 因子研究（5个）
2. 参数优化（3个）
3. 敏感性分析、蒙特卡洛
4. 告警中心（搁置）

---

## 决策记录

| 决策项 | 决策内容 |
|--------|----------|
| 模拟配置页面 | 删除单独页面，合并到模拟交易页面的设置抽屉 |
| Worker管理 | 合并到系统状态页面，不单独存在 |
| 告警中心 | 搁置，暂不实现 |
| 组件管理 | 扩展为6个页面，共用代码编辑器组件 |
| 数据同步 | 通过Kafka发送命令，DataWorker处理 |
| 回测对比 | 对比BASIC_ANALYZERS指标 |
| 订单/持仓 | 手动刷新，后续WebSocket推送 |
| 系统状态 | 实时刷新，日志功能TODO（未来接入分布式日志）|
1. 因子研究（5个）
2. 参数优化（3个）
3. 敏感性分析、蒙特卡洛
4. 系统管理（3个）

---

## 记录更新日志

| 日期 | 更新内容 |
|------|----------|
| 2026-02-18 | 初始规划，记录20+待实现页面 |
| 2026-02-18 | 组件管理改为代码编辑器模式，扩展为6个页面 |
| 2026-02-18 | Worker管理合并到系统状态，删除单独页面 |
| 2026-02-18 | 告警中心搁置 |
| 2026-02-18 | 模拟配置合并到模拟交易页面设置抽屉 |
| 2026-02-18 | 完善各页面后端支持和功能细节 |
| 2026-02-18 | 添加决策记录表 |
